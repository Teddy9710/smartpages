# 测试指南

## 一、准备工作

### 1.1 生成图标文件

插件需要图标才能正常加载。使用以下方法：

```bash
# 在浏览器中打开这个文件
icons/placeholder.html
```

然后：
1. 页面会自动生成4个图标（16x16, 32x32, 48x48, 128x128）
2. 点击每个图标下的"下载"按钮
3. 将下载的4个PNG文件保存到 `icons/` 目录，命名为：
   - icon16.png
   - icon32.png
   - icon48.png
   - icon128.png

### 1.2 验证文件结构

确保所有文件都已创建：

```bash
# Windows (Git Bash)
ls -la
ls -la popup/
ls -la settings/
ls -la sidepanel/
ls -la background/
ls -la content/
ls -la icons/

# 应该看到：
# manifest.json ✓
# popup/popup.html, popup.css, popup.js ✓
# settings/settings.html, settings.css, settings.js ✓
# sidepanel/sidepanel.html, sidepanel.css, sidepanel.js ✓
# background/background.js ✓
# content/recorder.js ✓
# icons/icon*.png (4个文件) ✓
```

## 二、加载插件

### 2.1 在Chrome中加载

1. 打开Chrome浏览器
2. 地址栏输入：`chrome://extensions/`
3. 打开右上角的"开发者模式"开关
4. 点击"加载已解压的扩展程序"
5. 选择项目根目录（`D:\plugins\smartpages`）
6. 确认插件成功加载（工具栏出现图标）

### 2.2 在Edge中加载

1. 打开Edge浏览器
2. 地址栏输入：`edge://extensions/`
3. 打开左下角的"开发人员模式"开关
4. 点击"加载解压缩的扩展"
5. 选择项目根目录
6. 确认加载成功

### 2.3 验证加载成功

- 工具栏出现插件图标（紫色的文档图标）
- 点击图标能打开弹出窗口
- 没有错误提示

## 三、功能测试

### 3.1 测试设置页面

**步骤：**
1. 点击插件图标
2. 点击"⚙️ 设置"按钮
3. 应该打开设置页面

**验证点：**
- [ ] 页面正常显示
- [ ] API Key输入框可输入
- [ ] 显示/隐藏密码按钮工作正常
- [ ] Base URL和模型名称输入框正常

**测试API配置：**
1. 输入OpenAI API Key（`sk-xxxx...`）
2. 点击"测试连接"
3. 应该显示成功或失败提示
4. 点击"保存配置"
5. 刷新页面，验证配置是否保存（应该显示脱敏的API Key）

**无API测试：**
1. 清空API Key
2. 保存配置
3. 应该能正常保存（但AI功能不可用）

### 3.2 测试录制功能（无需API）

**步骤：**
1. 打开一个简单的测试页面，如：`https://example.com`
2. **刷新页面**（重要！让content script注入）
3. 点击插件图标
4. 点击"开始录制"
5. 观察插件图标和弹出窗口变化

**验证点：**
- [ ] 状态变为"🔴 正在录制"
- [ ] 步数计数显示"0 个步骤"
- [ ] 点击页面上的按钮/链接
- [ ] 应该看到红色的波纹效果（点击反馈）
- [ ] 计数增加

**测试页面跳转：**
1. 在录制中，点击页面链接跳转到新页面
2. 应该记录为"navigate"类型的步骤

**停止录制：**
1. 再次点击插件图标
2. 点击"停止录制"
3. 应该显示"✅ 录制完成！"
4. 显示总步骤数
5. 出现"打开编辑器"按钮

### 3.3 测试AI功能（需要API）

**前提：** 已配置有效的API Key

**测试智能描述：**
1. 完成一个录制后
2. 侧边栏自动打开（或点击"打开编辑器"）
3. 应该显示"智能推测您可能想生成的文档"
4. 显示2-3个AI生成的描述选项
5. 可以选择描述或输入自定义描述

**测试文档生成：**
1. 选择一个描述或输入自定义描述
2. 点击"生成文档"
3. 显示"正在生成文档..."加载状态
4. 等待3-10秒
5. 应该生成Markdown文档
6. 自动切换到编辑器视图

**无API模式测试：**
1. 不配置API Key
2. 完成录制
3. 应该显示默认描述选项（不是AI生成的）

### 3.4 测试编辑器功能

**测试预览模式：**
1. 生成文档后
2. 默认在预览模式
3. 检查Markdown是否正确渲染：
   - 标题（#、##）
   - 列表（-、数字）
   - 代码块
   - 文字格式

**测试编辑模式：**
1. 点击"✏ 编辑"按钮
2. 切换到编辑模式
3. 可以看到原始Markdown文本
4. 修改文本
5. 切换回预览，验证修改生效

**测试复制功能：**
1. 点击"📋 复制"按钮
2. 按钮显示"✅ 已复制"
3. 粘贴到记事本验证

**测试下载功能：**
1. 点击"💾 下载"按钮
2. 应该下载 `.md` 文件
3. 打开文件验证内容

**测试新建：**
1. 点击右上角"📄"按钮
2. 返回空状态
3. 可以开始新录制

### 3.5 测试状态转换

**测试场景：**

1. **未录制 → 录制中**
   - 点击"开始录制"
   - 状态变为"录制中"

2. **录制中 → 已停止**
   - 点击"停止录制"
   - 状态变为"已停止"
   - 显示步骤总数

3. **已停止 → 未录制**
   - 点击"新建录制"
   - 状态重置为"未录制"

4. **录制中直接新建**
   - 在录制中点击"📄 新建"
   - 应该取消当前录制

### 3.6 测试错误处理

**测试场景：**

1. **无效API Key**
   - 输入错误的API Key
   - 点击"测试连接"
   - 应显示错误信息

2. **网络错误**
   - 断开网络
   - 尝试生成文档
   - 应显示"生成失败"并提供重试

3. **空录制**
   - 开始录制后不执行任何操作
   - 直接停止录制
   - 应显示0个步骤

## 四、调试方法

### 4.1 查看Console日志

**Popup调试：**
1. 右键点击插件图标
2. 选择"检查弹出内容"
3. 查看Console标签页

**Background调试：**
1. 打开 `chrome://extensions/`
2. 找到"Smart Page Scribe"
3. 点击"service worker"链接
4. 查看Console

**Content Script调试：**
1. 打开要录制的页面
2. 按F12打开开发者工具
3. 查看Console（应该看到 `[Smart Page Scribe]` 开头的日志）

**Side Panel调试：**
1. 打开侧边栏
2. 右键点击侧边栏
3. 选择"检查"
4. 查看Console

### 4.2 常见问题排查

**问题1：插件加载失败**
```
检查：
1. manifest.json语法是否正确
2. 图标文件是否存在（4个PNG文件）
3. 所有JS/CSS文件是否存在
```

**问题2：点击没反应**
```
检查：
1. 页面是否刷新（content script需要刷新）
2. Console是否有错误
3. 网站是否阻止了脚本注入
```

**问题3：AI生成失败**
```
检查：
1. API Key是否正确
2. Base URL是否可访问
3. 网络连接是否正常
4. API额度是否充足
```

**问题4：侧边栏无法打开**
```
检查：
1. manifest.json中是否配置了side_panel
2. sidepanel.html路径是否正确
3. Console是否有JS错误
```

### 4.3 日志输出

插件会在Console输出以下日志：

**Background:**
```
Smart Page Scribe installed
Recording started
Recording stopped
```

**Content Script:**
```
[Smart Page Scribe] Content script loaded
[Smart Page Scribe] Recording started
[Smart Page Scribe] Recording stopped
```

**Side Panel:**
```
Failed to generate descriptions: ...
Failed to generate document: ...
```

## 五、测试清单

### 基础功能测试

- [ ] 插件成功加载到浏览器
- [ ] Popup界面正常显示
- [ ] 设置页面可以打开
- [ ] API配置可以保存和加载
- [ ] 开始录制功能正常
- [ ] 点击操作被记录
- [ ] 页面跳转被记录
- [ ] 停止录制功能正常
- [ ] 步数统计正确
- [ ] 截图功能正常（检查currentSession数据）

### AI功能测试（需要API）

- [ ] AI生成描述选项
- [ ] 描述选项合理
- [ ] 可以选择描述
- [ ] 可以输入自定义描述
- [ ] AI生成文档
- [ ] 文档格式正确
- [ ] 内容准确反映操作

### 编辑器测试

- [ ] 预览模式渲染正确
- [ ] 编辑模式可以修改
- [ ] 复制功能正常
- [ ] 下载功能正常
- [ ] 新建功能正常

### 错误处理测试

- [ ] 无API时显示默认选项
- [ ] 错误API Key显示错误
- [ ] 网络错误显示友好提示
- [ ] 空录制正常处理

### 兼容性测试

测试以下网站：
- [ ] 简单静态页面（example.com）
- [ ] 表单页面
- [ ] SPA应用（如React/Vue应用）
- [ ] 多页面网站

## 六、性能测试

### 6.1 录制性能

**测试：**
1. 连续快速点击50次
2. 检查所有点击是否都被记录
3. 检查是否有性能卡顿

### 6.2 长时间录制

**测试：**
1. 录制100步操作
2. 检查内存占用
3. 检查数据完整性

### 6.3 截图性能

**测试：**
1. 执行10次点击
2. 每次点击后检查截图是否生成
3. 截图数据大小合理（每个<500KB）

## 七、真实场景测试

### 场景1：记录登录流程

1. 打开登录页面
2. 开始录制
3. 输入用户名、密码
4. 点击登录
5. 停止录制
6. 生成文档
7. 验证文档描述正确

### 场景2：记录购物流程

1. 打开电商网站
2. 浏览商品
3. 添加到购物车
4. 进入结算
5. 停止录制
6. 生成文档

### 场景3：记录表单填写

1. 打开表单页面
2. 填写多个字段
3. 提交表单
4. 停止录制
5. 验证每个字段都被记录

## 八、快速测试命令

```bash
# 验证文件完整性
find . -name "*.js" -o -name "*.html" -o -name "*.css" -o -name "*.json" | grep -v node_modules

# 检查manifest.json语法
cat manifest.json | python -m json.tool

# 统计代码行数
find . -name "*.js" -not -path "./node_modules/*" | xargs wc -l
```

## 九、测试报告模板

```markdown
## 测试报告

**测试日期：** 2025-XX-XX
**测试环境：** Chrome 120+ / Windows 11
**API：** OpenAI gpt-3.5-turbo

### 功能测试结果
- [x] 插件加载 - 通过
- [x] 设置页面 - 通过
- [x] 录制功能 - 通过
- [ ] AI功能 - 待测试（需要API）
- [x] 编辑器 - 通过

### 发现的问题
1. 问题描述
   - 重现步骤
   - 严重程度

### 建议
- 改进建议
```

## 十、下一步

测试通过后，您可以：
1. 打包插件（.zip文件）
2. 分发测试版本
3. 收集用户反馈
4. 优化功能
5. 准备发布到Chrome Web Store

---

**开始测试吧！** 🚀
